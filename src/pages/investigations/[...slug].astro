---
import BaseLayout from '../../layouts/BaseLayout.astro';
import DateStamp from '../../components/DateStamp.astro';
import TagList from '../../components/TagList.astro';
import YouTubeEmbed from '../../components/YouTubeEmbed.astro';
import RoughLine from '../../components/rough/RoughLine.tsx';
import { getCollection, render } from 'astro:content';

export async function getStaticPaths() {
  const investigations = await getCollection('investigations');
  return investigations.map((investigation) => ({
    params: { slug: investigation.id },
    props: { investigation },
  }));
}

const { investigation } = Astro.props;
const { Content } = await render(investigation);
---

<BaseLayout title={`${investigation.data.title} â€” Investigations`} description={investigation.data.summary}>
  <article class="py-8">
    <YouTubeEmbed videoId={investigation.data.youtubeId} title={investigation.data.title} />

    <header class="mt-6 mb-8">
      <DateStamp date={investigation.data.date} />
      <h1 class="font-title text-3xl md:text-4xl font-bold mt-4 mb-2">{investigation.data.title}</h1>
      <p class="text-ink-secondary text-lg mb-4">{investigation.data.summary}</p>
      <TagList tags={investigation.data.tags} />
    </header>

    <div class="prose mt-8">
      <Content />
    </div>

    {investigation.data.sources.length > 0 && (
      <>
        <RoughLine client:visible />
        <section class="py-6">
          <h2 class="font-title text-xl font-bold mb-4">Sources & Further Reading</h2>
          <ul class="list-none p-0 space-y-2">
            {investigation.data.sources.map((source) => (
              <li>
                <a href={source.url} target="_blank" rel="noopener noreferrer" class="font-mono text-sm hover:text-terracotta-hover">
                  {source.title} <span class="text-xs">&#8599;</span>
                </a>
              </li>
            ))}
          </ul>
        </section>
      </>
    )}

    <nav class="py-4 border-t border-border mt-6">
      <a href="/investigations" class="font-mono text-sm hover:text-terracotta-hover">&larr; All investigations</a>
    </nav>
  </article>
</BaseLayout>

<style>
  /* Editor combo: IBM Plex Sans body (headings/spacing from global .prose) */
  .prose { font-family: var(--font-body-alt); }
</style>

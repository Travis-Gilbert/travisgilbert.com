---
import BaseLayout from '../layouts/BaseLayout.astro';
import InvestigationCard from '../components/InvestigationCard.astro';
import FieldNoteEntry from '../components/FieldNoteEntry.astro';
import ProjectCard from '../components/ProjectCard.astro';
import RoughLine from '../components/rough/RoughLine.tsx';
import RoughUnderline from '../components/rough/RoughUnderline.tsx';
import MagnifyingGlass from 'phosphor-astro/MagnifyingGlass.astro';
import NotePencil from 'phosphor-astro/NotePencil.astro';
import Briefcase from 'phosphor-astro/Briefcase.astro';
import { getCollection } from 'astro:content';

const investigations = (await getCollection('investigations'))
  .filter((i) => !i.data.draft)
  .sort((a, b) => b.data.date.valueOf() - a.data.date.valueOf())
  .slice(0, 3);

const fieldNotes = (await getCollection('field-notes'))
  .filter((n) => !n.data.draft)
  .sort((a, b) => b.data.date.valueOf() - a.data.date.valueOf())
  .slice(0, 5);

const projects = (await getCollection('projects'))
  .filter(p => !p.data.draft && p.data.featured)
  .sort((a, b) => a.data.order - b.data.order)
  .slice(0, 3);
---

<BaseLayout title="Travis Gilbert">
  <!-- Hero -->
  <section class="py-12 md:py-16">
    <h1 class="text-4xl md:text-5xl mb-4" style="font-family: var(--font-name); font-weight: 400;">
      <RoughUnderline client:visible type="underline" color="var(--color-terracotta)" strokeWidth={2}>
        Travis Gilbert
      </RoughUnderline>
    </h1>
    <p class="text-ink-secondary text-lg md:text-xl max-w-2xl leading-relaxed">
      Investigating how design decisions shape human outcomes.
    </p>
  </section>

  <!-- Latest Investigations -->
  {investigations.length > 0 && (
    <section class="py-8">
      <h2 class="font-title text-2xl font-bold mb-6 flex items-center gap-2">
        <MagnifyingGlass class="w-6 h-6 text-terracotta" />
        Latest Investigations
      </h2>
      <div class="space-y-6">
        {investigations.map((investigation) => (
          <InvestigationCard
            title={investigation.data.title}
            summary={investigation.data.summary}
            date={investigation.data.date}
            youtubeId={investigation.data.youtubeId}
            tags={investigation.data.tags}
            href={`/investigations/${investigation.id}`}
          />
        ))}
      </div>
      <p class="mt-6">
        <a href="/investigations" class="font-mono text-sm hover:text-terracotta-hover">
          All investigations &rarr;
        </a>
      </p>
    </section>
  )}

  <RoughLine client:visible />

  <!-- Recent Field Notes -->
  {fieldNotes.length > 0 && (
    <section class="py-8">
      <h2 class="font-title text-2xl font-bold mb-6 flex items-center gap-2">
        <NotePencil class="w-6 h-6 text-terracotta" />
        Recent Field Notes
      </h2>
      <div class="space-y-4">
        {fieldNotes.map((note) => (
          <FieldNoteEntry
            title={note.data.title}
            date={note.data.date}
            excerpt={note.data.excerpt}
            tags={note.data.tags}
            href={`/field-notes/${note.id}`}
          />
        ))}
      </div>
      <p class="mt-6">
        <a href="/field-notes" class="font-mono text-sm hover:text-terracotta-hover">
          All field notes &rarr;
        </a>
      </p>
    </section>
  )}

  <!-- Projects -->
  {projects.length > 0 && (
    <>
      <RoughLine client:visible />
      <section class="py-8">
        <h2 class="font-title text-2xl font-bold mb-6 flex items-center gap-2">
          <Briefcase class="w-6 h-6 text-terracotta" />
          Projects
        </h2>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
          {projects.map((project) => (
            <ProjectCard
              title={project.data.title}
              role={project.data.role}
              description={project.data.description}
              year={project.data.year}
              urls={project.data.urls}
              tags={project.data.tags}
            />
          ))}
        </div>
        <p class="mt-6">
          <a href="/projects" class="font-mono text-sm hover:text-terracotta-hover">
            All projects &rarr;
          </a>
        </p>
      </section>
    </>
  )}
</BaseLayout>
